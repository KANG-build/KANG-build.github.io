---
layout: default
title: SRC Lab. Login
---
<div class="blog-page">
 <div class="container">
  <div class="login-page-wrap">

   <!-- Login Form -->
   <div class="login-card" id="loginCard">
    <div class="login-card-header">
     <div class="login-logo-area">
      <span class="glyphicon glyphicon-lock login-logo-icon"></span>
     </div>
     <h2 class="login-title">SRC Lab. Blog</h2>
     <p class="login-subtitle">연구실 블로그에 로그인하세요</p>
    </div>
    <div class="login-card-body">
     <div class="login-alert" id="loginAlert" style="display:none;"></div>

     <!-- Kakao Login Button -->
     <div id="kakaoLoginWrap" style="display:none;">
      <button class="login-btn-kakao" id="kakaoLoginBtn" onclick="doKakaoLogin()">
       <svg class="kakao-symbol" viewBox="0 0 24 24" width="20" height="20"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.735 1.805 5.135 4.522 6.504-.148.551-.952 3.55-.985 3.782 0 0-.02.165.087.228.107.063.233.03.233.03.307-.043 3.558-2.33 4.118-2.724.332.048.671.073 1.025.073 5.523 0 10-3.463 10-7.693C22 6.463 17.523 3 12 3" fill="#181600"/></svg>
       카카오 로그인
      </button>
      <div class="login-divider">
       <span class="login-divider-line"></span>
       <span class="login-divider-text">또는</span>
       <span class="login-divider-line"></span>
      </div>
     </div>

     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-user"></span> 아이디</label>
      <input type="text" id="loginUsername" class="login-input" placeholder="아이디를 입력하세요" autocomplete="username" maxlength="30">
     </div>
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-lock"></span> 비밀번호</label>
      <input type="password" id="loginPassword" class="login-input" placeholder="비밀번호를 입력하세요" autocomplete="current-password" maxlength="100">
     </div>
     <button class="login-btn" id="loginBtn" onclick="doLogin()">
      <span class="glyphicon glyphicon-log-in"></span> 로그인
     </button>
     <div class="login-footer-links">
      <span>계정이 없으신가요?</span>
      <a href="javascript:void(0)" onclick="showRegister()">회원가입</a>
     </div>
    </div>
   </div>

   <!-- Kakao Member Linking Card (shown after first Kakao login) -->
   <div class="login-card" id="kakaoLinkCard" style="display:none;">
    <div class="login-card-header" style="background: linear-gradient(135deg, #FEE500 0%, #F5D300 100%);">
     <div class="login-logo-area">
      <svg viewBox="0 0 24 24" width="40" height="40"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.735 1.805 5.135 4.522 6.504-.148.551-.952 3.55-.985 3.782 0 0-.02.165.087.228.107.063.233.03.233.03.307-.043 3.558-2.33 4.118-2.724.332.048.671.073 1.025.073 5.523 0 10-3.463 10-7.693C22 6.463 17.523 3 12 3" fill="#181600"/></svg>
     </div>
     <h2 class="login-title" style="color:#181600;">카카오 로그인 완료!</h2>
     <p class="login-subtitle" style="color:#3C1E1E; opacity:0.8;">연구실 멤버라면 본인을 선택해주세요</p>
    </div>
    <div class="login-card-body">
     <div class="login-alert" id="kakaoLinkAlert" style="display:none;"></div>
     <p style="font-size:14px; color:#555; margin-bottom:12px; text-align:center;">
      멤버로 연동하면 <strong>글 작성</strong>이 가능합니다.<br>
      <small style="color:#999;">일반 사용자로 계속하려면 "건너뛰기"를 누르세요.</small>
     </p>
     <div class="login-member-grid" id="kakaoMemberGrid"></div>
     <input type="hidden" id="kakaoLinkMemberId" value="">
     <div style="display:flex; gap:10px; margin-top:16px;">
      <button class="login-btn" style="flex:1; background:#e0e0e0; color:#555;" onclick="skipKakaoLink()">
       건너뛰기
      </button>
      <button class="login-btn login-btn-green" id="kakaoLinkBtn" style="flex:1;" onclick="doKakaoLink()">
       <span class="glyphicon glyphicon-ok"></span> 멤버 연동
      </button>
     </div>
    </div>
   </div>

   <!-- Register Form -->
   <div class="login-card" id="registerCard" style="display:none;">
    <div class="login-card-header">
     <div class="login-logo-area">
      <span class="glyphicon glyphicon-plus-sign login-logo-icon" style="color:#27ae60;"></span>
     </div>
     <h2 class="login-title">회원가입</h2>
     <p class="login-subtitle">새 계정을 만들고 블로그에 참여하세요</p>
    </div>
    <div class="login-card-body">
     <div class="login-alert" id="registerAlert" style="display:none;"></div>
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-user"></span> 아이디</label>
      <input type="text" id="regUsername" class="login-input" placeholder="영문, 숫자, 밑줄 3~30자" autocomplete="username" maxlength="30">
      <small class="login-hint">영문, 숫자, 밑줄(_)만 사용 가능</small>
     </div>
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-tag"></span> 표시 이름</label>
      <input type="text" id="regDisplayName" class="login-input" placeholder="댓글 등에 표시될 이름" maxlength="50">
     </div>
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-lock"></span> 비밀번호</label>
      <input type="password" id="regPassword" class="login-input" placeholder="6자 이상" autocomplete="new-password" maxlength="100">
     </div>
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-lock"></span> 비밀번호 확인</label>
      <input type="password" id="regPasswordConfirm" class="login-input" placeholder="비밀번호를 다시 입력하세요" autocomplete="new-password" maxlength="100">
     </div>

     <!-- Member Linking -->
     <div class="login-field">
      <label class="login-label"><span class="glyphicon glyphicon-education"></span> 연구실 멤버 연동 <small>(선택)</small></label>
      <p class="login-hint" style="margin-bottom:8px;">연구실 멤버라면 본인을 선택하세요. 멤버로 인증되면 글 작성이 가능합니다.</p>
      <div class="login-member-grid" id="memberGrid"></div>
      <input type="hidden" id="regMemberId" value="">
     </div>

     <button class="login-btn login-btn-green" id="registerBtn" onclick="doRegister()">
      <span class="glyphicon glyphicon-ok"></span> 가입하기
     </button>
     <div class="login-footer-links">
      <span>이미 계정이 있으신가요?</span>
      <a href="javascript:void(0)" onclick="showLogin()">로그인</a>
     </div>
    </div>
   </div>

  </div>
 </div>
</div>

<script>
var API_BASE = window.location.origin;
var BASE_URL = '{{ site.baseurl }}';

// Check if already logged in & handle Kakao link flow
(function() {
    var params = new URLSearchParams(window.location.search);

    // Show error from Kakao OAuth if any
    var errorMsg = params.get('error');
    if (errorMsg) {
        setTimeout(function() { showAlert('loginAlert', decodeURIComponent(errorMsg)); }, 100);
    }

    // Check Kakao status to show/hide button
    fetch(API_BASE + '/api/auth/kakao/status')
    .then(function(r) { return r.json(); })
    .then(function(data) {
        if (data.enabled) {
            document.getElementById('kakaoLoginWrap').style.display = 'block';
        }
    }).catch(function() {});

    // Check if this is a Kakao member linking flow
    var kakaoLink = params.get('kakao_link');
    if (kakaoLink === 'true') {
        fetch(API_BASE + '/api/auth/me', { credentials: 'same-origin' })
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data.logged_in) {
                // Show member linking card
                showKakaoLinkCard();
            }
        });
        return; // Don't redirect
    }

    fetch(API_BASE + '/api/auth/me', { credentials: 'same-origin' })
    .then(function(r) { return r.json(); })
    .then(function(data) {
        if (data.logged_in) {
            var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
            window.location.href = redirect;
        }
    });
})();

function showLogin() {
    document.getElementById('loginCard').style.display = '';
    document.getElementById('registerCard').style.display = 'none';
    clearAlerts();
}

function showRegister() {
    document.getElementById('loginCard').style.display = 'none';
    document.getElementById('registerCard').style.display = '';
    clearAlerts();
    loadMembers();
}

function clearAlerts() {
    document.getElementById('loginAlert').style.display = 'none';
    document.getElementById('registerAlert').style.display = 'none';
}

function showAlert(id, msg, type) {
    var el = document.getElementById(id);
    el.className = 'login-alert login-alert-' + (type || 'error');
    el.textContent = msg;
    el.style.display = 'block';
}

function doLogin() {
    var username = document.getElementById('loginUsername').value.trim();
    var password = document.getElementById('loginPassword').value;
    if (!username || !password) {
        showAlert('loginAlert', '아이디와 비밀번호를 입력해주세요.');
        return;
    }
    var btn = document.getElementById('loginBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="login-spinner-sm"></span> 로그인 중...';

    fetch(API_BASE + '/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'same-origin',
        body: JSON.stringify({ username: username, password: password })
    })
    .then(function(r) { return r.json().then(function(d) { return { status: r.status, data: d }; }); })
    .then(function(res) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-log-in"></span> 로그인';
        if (res.data.success) {
            var params = new URLSearchParams(window.location.search);
            var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
            window.location.href = redirect;
        } else {
            showAlert('loginAlert', res.data.error || '로그인에 실패했습니다.');
        }
    })
    .catch(function(e) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-log-in"></span> 로그인';
        showAlert('loginAlert', '서버 오류: ' + e.message);
    });
}

function doRegister() {
    var username = document.getElementById('regUsername').value.trim();
    var displayName = document.getElementById('regDisplayName').value.trim();
    var password = document.getElementById('regPassword').value;
    var passwordConfirm = document.getElementById('regPasswordConfirm').value;
    var memberId = document.getElementById('regMemberId').value;

    if (!username) { showAlert('registerAlert', '아이디를 입력해주세요.'); return; }
    if (!displayName) { showAlert('registerAlert', '표시 이름을 입력해주세요.'); return; }
    if (!password) { showAlert('registerAlert', '비밀번호를 입력해주세요.'); return; }
    if (password !== passwordConfirm) { showAlert('registerAlert', '비밀번호가 일치하지 않습니다.'); return; }
    if (password.length < 6) { showAlert('registerAlert', '비밀번호는 6자 이상이어야 합니다.'); return; }

    var btn = document.getElementById('registerBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="login-spinner-sm"></span> 가입 중...';

    fetch(API_BASE + '/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'same-origin',
        body: JSON.stringify({
            username: username,
            password: password,
            display_name: displayName,
            member_id: memberId || null
        })
    })
    .then(function(r) { return r.json().then(function(d) { return { status: r.status, data: d }; }); })
    .then(function(res) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-ok"></span> 가입하기';
        if (res.data.success) {
            var params = new URLSearchParams(window.location.search);
            var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
            window.location.href = redirect;
        } else {
            showAlert('registerAlert', res.data.error || '회원가입에 실패했습니다.');
        }
    })
    .catch(function(e) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-ok"></span> 가입하기';
        showAlert('registerAlert', '서버 오류: ' + e.message);
    });
}

function loadMembers() {
    var grid = document.getElementById('memberGrid');
    if (grid.children.length > 0) return; // already loaded
    Promise.all([
        fetch(API_BASE + '/api/members').then(function(r) { return r.json(); }),
        fetch(API_BASE + '/api/auth/claimed-members').then(function(r) { return r.json(); })
    ]).then(function(results) {
        var members = results[0];
        var claimed = results[1].claimed || [];
        grid.innerHTML = '';
        // Add "none" option
        var noneCard = document.createElement('div');
        noneCard.className = 'login-member-card selected';
        noneCard.setAttribute('data-id', '');
        noneCard.onclick = function() { selectMember('', this); };
        noneCard.innerHTML = '<div class="login-member-card-icon"><span class="glyphicon glyphicon-user"></span></div>' +
            '<div class="login-member-card-name">일반 사용자</div>' +
            '<div class="login-member-card-role">비멤버</div>';
        grid.appendChild(noneCard);

        members.forEach(function(m) {
            var isClaimed = claimed.indexOf(m.id) !== -1;
            var card = document.createElement('div');
            card.className = 'login-member-card' + (isClaimed ? ' login-member-card-disabled' : '');
            card.setAttribute('data-id', m.id);
            if (!isClaimed) {
                card.onclick = function() { selectMember(m.id, this); };
            }
            card.innerHTML = '<img src="' + m.photo + '" class="login-member-card-photo img-circle" alt="">' +
                '<div class="login-member-card-name">' + m.name + '</div>' +
                '<div class="login-member-card-role">' + (isClaimed ? '<span class="glyphicon glyphicon-lock" style="font-size:9px;"></span> 등록됨' : (m.role || '')) + '</div>';
            grid.appendChild(card);
        });
    });
}

function selectMember(memberId, el) {
    document.getElementById('regMemberId').value = memberId;
    document.querySelectorAll('.login-member-card').forEach(function(c) { c.classList.remove('selected'); });
    if (el) el.classList.add('selected');
}

// ==================== Kakao Login ====================
function doKakaoLogin() {
    var params = new URLSearchParams(window.location.search);
    var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
    window.location.href = API_BASE + '/api/auth/kakao/login?redirect=' + encodeURIComponent(redirect);
}

function showKakaoLinkCard() {
    document.getElementById('loginCard').style.display = 'none';
    document.getElementById('registerCard').style.display = 'none';
    document.getElementById('kakaoLinkCard').style.display = '';
    loadKakaoMembers();
}

function loadKakaoMembers() {
    var grid = document.getElementById('kakaoMemberGrid');
    if (grid.children.length > 0) return;
    Promise.all([
        fetch(API_BASE + '/api/members').then(function(r) { return r.json(); }),
        fetch(API_BASE + '/api/auth/claimed-members').then(function(r) { return r.json(); })
    ]).then(function(results) {
        var members = results[0];
        var claimed = results[1].claimed || [];
        grid.innerHTML = '';
        members.forEach(function(m) {
            var isClaimed = claimed.indexOf(m.id) !== -1;
            var card = document.createElement('div');
            card.className = 'login-member-card' + (isClaimed ? ' login-member-card-disabled' : '');
            card.setAttribute('data-id', m.id);
            if (!isClaimed) {
                card.onclick = function() { selectKakaoMember(m.id, this); };
            }
            card.innerHTML = '<img src="' + m.photo + '" class="login-member-card-photo img-circle" alt="">' +
                '<div class="login-member-card-name">' + m.name + '</div>' +
                '<div class="login-member-card-role">' + (isClaimed ? '<span class="glyphicon glyphicon-lock" style="font-size:9px;"></span> 등록됨' : (m.role || '')) + '</div>';
            grid.appendChild(card);
        });
    });
}

function selectKakaoMember(memberId, el) {
    document.getElementById('kakaoLinkMemberId').value = memberId;
    document.querySelectorAll('#kakaoMemberGrid .login-member-card').forEach(function(c) { c.classList.remove('selected'); });
    if (el) el.classList.add('selected');
}

function doKakaoLink() {
    var memberId = document.getElementById('kakaoLinkMemberId').value;
    if (!memberId) {
        showAlert('kakaoLinkAlert', '멤버를 선택해주세요. 건너뛰려면 "건너뛰기"를 누르세요.');
        return;
    }
    var btn = document.getElementById('kakaoLinkBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="login-spinner-sm"></span> 연동 중...';

    fetch(API_BASE + '/api/auth/kakao/link-member', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'same-origin',
        body: JSON.stringify({ member_id: memberId })
    })
    .then(function(r) { return r.json().then(function(d) { return { status: r.status, data: d }; }); })
    .then(function(res) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-ok"></span> 멤버 연동';
        if (res.data.success) {
            var params = new URLSearchParams(window.location.search);
            var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
            window.location.href = redirect;
        } else {
            showAlert('kakaoLinkAlert', res.data.error || '연동에 실패했습니다.');
        }
    })
    .catch(function(e) {
        btn.disabled = false;
        btn.innerHTML = '<span class="glyphicon glyphicon-ok"></span> 멤버 연동';
        showAlert('kakaoLinkAlert', '서버 오류: ' + e.message);
    });
}

function skipKakaoLink() {
    var params = new URLSearchParams(window.location.search);
    var redirect = params.get('redirect') || BASE_URL + '/pages/blog.html';
    window.location.href = redirect;
}

// Enter key to submit
document.getElementById('loginPassword').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') doLogin();
});
document.getElementById('loginUsername').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') doLogin();
});
document.getElementById('regPasswordConfirm').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') doRegister();
});
</script>
